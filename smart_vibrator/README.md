# 智能振捣系统（Smart Vibrator System）

## 项目简介
本系统用于提升混凝土施工质量，基于物联网与AI技术，实现混凝土入场自动识别、环境参数采集、振捣策略智能生成、设备控制与数据闭环。系统支持在Windows和Ubuntu环境下运行，并可通过GPIO接口控制真实的步进电机进行振捣操作。

## 主要功能模块

1. **混凝土入场识别**  
   - 通过摄像头扫描混凝土配料单，提取骨料类型、水灰比、配比比例等信息。
   - 目前为模拟OCR接口，返回伪造数据。

2. **环境参数采集**  
   - 通过传感器接口采集温度、湿度、坠落度、钢筋分布密度。
   - 多次采集温度并取平均值，提高数据精度。
   - 目前为模拟传感器接口，返回随机数据。

3. **振捣策略生成**  
   - 根据材料和环境参数，自动生成详细的振捣策略。
   - 为每个振捣点位计算不同的频率、时间、深度和有效半径。
   - 考虑点位位置、板块尺寸、材料特性等多种因素。
   - 支持用户输入缺失参数，并提供合理默认值。

4. **设备控制与执行**  
   - 根据策略控制步进电机进行振捣操作。
   - 支持顺时针和逆时针旋转，模拟不同振捣方式。
   - 根据频率自动调整电机速度和步进模式。
   - 兼容模拟模式和真实GPIO控制模式。

5. **振捣点位可视化**  
   - 生成振捣点位的三维可视化图形。
   - 使用颜色映射显示不同频率的点位。
   - 支持Windows和Ubuntu上的中文字体显示。
   - 可保存高清图像用于报告和分析。

6. **数据闭环上传**  
   - 将振捣策略和执行数据保存为JSON格式。
   - 支持后续扩展云端上传。

7. **跨平台兼容性**  
   - 支持Windows和Ubuntu环境运行。
   - 自动检测平台并适配字体和接口。

## 目录结构

```
smart_vibrator/
├─ main.py                # 主程序入口，协调各模块运行
├─ vibration_strategy.py   # 振捣策略生成模块
├─ device_control.py      # 设备控制模块，实现步进电机控制
├─ visualize_points.py    # 振捣点位可视化模块
├─ cloud_upload.py        # 数据上传模块
├─ utils/                 # 工具模块
│   ├─ sensor_interface.py # 传感器接口
│   ├─ camera_ocr.py       # 摄像头和OCR接口
│   └─ config.py           # 配置文件
├─ output/                # 输出目录
│   ├─ vibration_strategy.json # 振捣策略JSON文件
│   └─ vibration_points.png   # 振捣点位可视化图像
└─ data/reports/          # 数据报告存储目录
```

## 当前实现说明

- **所有核心流程均可完整运行，支持Windows和Ubuntu环境。**
- 混凝土材料参数、环境参数均为模拟生成（伪造/随机），但可以轻松替换为真实数据采集。
- 振捣策略生成模块已实现详细的策略计算，能够根据材料和环境参数生成最优的振捣方案。
- 设备控制模块已实现步进电机控制，可以在Ubuntu环境下通过GPIO接口控制真实的电机。
- 可视化模块可生成三维图形，直观展示振捣点位布局和参数。
- 所有数据和策略保存为JSON格式，便于后续分析和处理。
- 配置项集中于 `utils/config.py`，便于后续修改。

## 后续优化与待开发部分

1. **云端数据上传**
   - 在 `cloud_upload.py` 中实现真实的云端接口调用。

2. **振捣策略进一步优化**
   - 增加更多工程参数和材料特性的影响因素。
   - 根据实际测试数据调整振捣策略生成算法。

3. **可视化功能增强**
   - 增加实时振捣过程的可视化监控。
   - 添加振捣效果预测和模拟功能。

4. **界面与交互**
   - 开发Web界面，支持远程控制和监控。
   - 增加移动端应用支持。

5. **多设备协同作业**
   - 支持多个振捣设备同时工作的协调策略。

## Ubuntu 部署与运行说明

1. **环境准备**
   - 安装 Python 3.7+
   - 建议创建虚拟环境：
     ```sh
     python3 -m venv venv
     source venv/bin/activate
     ```
   - 安装依赖包：
     ```sh
     pip install numpy matplotlib
     ```
   - 安装GPIO库（用于控制步进电机）：
     ```sh
     sudo apt-get install python3-rpi.gpio
     ```
   - 安装中文字体（用于可视化）：
     ```sh
     sudo apt-get install fonts-wqy-zenhei fonts-wqy-microhei
     ```

2. **运行主程序**
   - 如果需要使用GPIO控制步进电机，需要root权限：
     ```sh
     sudo python3 main.py
     ```
   - 如果只需要模拟运行：
     ```sh
     python3 main.py
     ```

3. **使用可视化功能**
   - 在程序运行过程中选择是否需要可视化振捣点位布局
   - 可视化图像保存在 `output/` 目录下

4. **控制步进电机**
   - 将步进电机连接到GPIO引脚(18, 23, 24, 25)
   - 在程序运行过程中选择是否执行振捣操作

5. **查看输出文件**
   - 振捣策略JSON文件：`output/vibration_strategy.json`
   - 可视化图像：`output/vibration_points.png`
   - 数据报告：`data/reports/`目录下

## 已完成与待完成事项

### 已完成
- 项目基础结构与全流程打通
- 振捣策略生成模块实现详细策略计算
- 设备控制模块实现步进电机控制
- 振捣点位可视化模块实现三维图形生成
- 跨平台兼容性（Windows和Ubuntu）
- 数据保存与JSON格式输出

### 待完成
- 对接真实摄像头与OCR识别
- 对接真实环境传感器
- 实现云端数据上传
- 开发Web界面和移动端应用
- 多设备协同作业支持
- 云端上传与异常处理
- 策略与参数优化
- 更丰富的用户交互界面

---

如需对接具体硬件、扩展功能或遇到部署问题，请随时联系开发助手！
